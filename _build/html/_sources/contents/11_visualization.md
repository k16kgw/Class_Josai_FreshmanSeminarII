# 可視化

出席パスワード：**538276**

到達目標
- **可視化の目的**を意識してグラフを選択できるようになる
- Matplotlib を用いて基本的なグラフを作成できる
- これまでの演習（数値計算・乱数・モンテカルロ法）の結果を **適切な形で可視化**できる
- 「なぜそのグラフを使ったのか」を説明できる

準備
1. anaconda を使用し，<span style="color:red">jupyter lab</span> を起動する
2. `Document（書類）/Fresh` フォルダを開き，新しいノートブックを作成する
3. ファイル名を`11_{学籍番号}_{氏名}.ipynb`に変更する．
    例：`11_SI25999_香川渓一郎.ipynb`

---

## 第10回までの復習（可視化の視点から）

これまでに次のような **数値データ** を扱ってきた．

- 数値微分・数値積分における **誤差の変化**
- 分割数$n$，試行回数$N$に対する **近似値の収束**
- 乱数による**ばらつき**
- モンテカルロ法による**確率・積分の推定値**

単なる数の並びではなく，数の「変化・分布・傾向」を見ることが本質．

### 課題の解答例

```{note}
<span style="color:red">**第10回課題1**</span>

サイコロを 5000 回振ったときの **1〜6 が出る回数** を数え，  
次の形式で表示せよ：

```text
1: xxx回
2: xxx回
3: xxx回
4: xxx回
5: xxx回
6: xxx回
```

```python
import random

N = 5000
counts = [0,0,0,0,0,0] # 1～6の回数を0で初期化

for _ in range(N):
   d = random.randint(1, 6)
   counts[d-1] += 1

for i in range(1, 7):
   print(f"{i}: {counts[i-1]}回")
```

```{note}
<span style="color:red">**第10回課題2**</span>

$$
\int_0^\pi \sin x dx = 2
$$

について，  
- $N = 1000, 3000, 10000, 30000$ でモンテカルロ法による近似値を計算し，**区分求積法と台形公式**に比べて真の値に近づく速さがどのように異なるかを比較せよ．
- つまり，$N=1000$から3・10・30倍になったときに誤差は何倍になるかを**モンテカルロ法**・**区分求積法**・**台形公式**について数値計算して求め，それぞれ比較せよ．
```

```python
import math
import random

def f(x):
    return math.sin(x)

exact = 2.0

# モンテカルロ積分
def mc_integral(f, a, b, N=1000):
    total = 0
    for _ in range(N):
        x = random.uniform(a, b)   # 区間[a,b] の乱数
        total += f(x)
    return (b - a) * total / N

# 区分求積法（左端）
def integral_riemann(f, a, b, n=1000):
    width = (b - a) / n
    area = 0
    for i in range(n):
        x = a + i * width  # 左端の値
        area += f(x) * width
    return area

# 台形公式
def integral_trapezoid(f, a, b, n=1000):
    h = (b - a) / n
    s = 0
    for i in range(1, n):
        x = a + i * h
        s += 2 * f(x)
    s += f(a) + f(b)
    return s * h / 2
```

```python
Ns = [1000, 3000, 10000, 30000]

# モンテカルロは乱数なので、比較を安定させたいなら seed を固定（任意）
random.seed(0)

print("N\tMC値\t\tMC誤差\t\t区分求積誤差\t台形誤差")
for N in Ns:
   mc = mc_integral(f, 0, math.pi, N)
   riem = integral_riemann(f, 0, math.pi, N)
   trap = integral_trapezoid(f, 0, math.pi, N)

   # 誤差を計算    
   err_mc = abs(mc - exact)
   err_riem = abs(riem - exact)
   err_trap = abs(trap - exact)
    
   print(f"{N}\t{mc:.10f}\t{err_mc:.3e}\t{err_riem:.3e}\t{err_trap:.3e}")
```

出力例
```text
N	MC値		MC誤差		区分求積誤差	台形誤差
1000	1.9921363758	7.864e-03	1.645e-06	1.645e-06
3000	1.9968261933	3.174e-03	1.828e-07	1.828e-07
10000	2.0119863603	1.199e-02	1.645e-08	1.645e-08
30000	1.9958621988	4.138e-03	1.828e-09	1.828e-09
```

モンテカルロ法は乱数を使うため誤差にばらつきがあるが，区分求積法・台形公式に基づく数値積分では$N$の増加とともに誤差が小さくなる．

→ $N$がp倍増加するのに対して誤差がどれくらいの倍率で小さくなるかをわかりやすくするために<span style="color:red">可視化</span>を有効活用する．

---

## 可視化の方法

### 関係を見るための可視化（関係・変化）

対象：
- 横軸と縦軸との**関係**
- ある量が**どう変化するか**
- 収束・発散・増減の様子

代表例：
- 折れ線グラフ（line plot）
- 散布図（scatter plot）

例：
- 分割数$n$と誤差の関係
- 試行回数$N$と近似値の変化

### 分布を見るための可視化（ばらつき・確率）

対象：
- 値が**どのあたりに多いか**
- ばらつきの大きさ
- 偏りがあるかどうか

代表例：
- ヒストグラム
- 棒グラフ

例：
- 乱数の分布
- サイコロの出目の回数
- モンテカルロ法の結果のばらつき

```{warning}
可視化する前に**何を見たいのか**をはっきりさせる．

- 「変化」を見たい→折れ線グラフ
- 「関係」を見たい→散布図
- 「分布」を見たい→ヒストグラム
- 「量」を見たい→棒グラフ
```

<!-- ### 何が起きているかを見るための可視化 -->

---

## 可視化の基準

### 横軸：何が変わるか

- 時間
- 分割数$n$
- 試行回数$N$

**連続的・順序のある量** → 折れ線グラフ

### 縦軸：何を評価したいか

- 近似値そのもの
- 誤差
- 回数・頻度

評価対象が「値」なら折れ線グラフ
評価対象が「回数」なら棒グラフ・ヒストグラム

### 比較したいものはいくつあるか

- 1つ → 単純なグラフ
- 複数 → 同一軸上に複数曲線 or 凡例（legend）

---

## Matplotlibの基本

まず初めにライブラリをインポートする．
ライブラリ内のモジュールを呼び出すが，名前が長いので`plt`と呼ぶことにする．
```python
import matplotlib.pyplot as plt
```

- Matplotlibは**数値データ**を**図**に変換する道具
- **データ構造**（リスト・配列）とグラフの対応を理解することが重要

### 折れ線グラフの例

```python
x = [1, 2, 3, 4, 5]
y = [1, 4, 9, 16, 25]

fig, ax = plt.subplots() # グラフの作成するオブジェクトを用意する
ax.plot(x, y) # x軸をx，y軸をyとして折れ線グラフを作成する
ax.set_xlabel("x") # x軸の名前をxとする
ax.set_ylabel("y") # y軸の名前をyとする

plt.show()
```

`fig`は図の大枠，`ax`は座標系を指すオブジェクト．

次のようなより簡潔な書き方もあるが，こちらは拡張性に乏しい．
```python
plt.plot(x, y) # x軸をx，y軸をyとして折れ線グラフを作成する
plt.xlabel("x") # x軸の名前をxとする
plt.ylabel("y") # y軸の名前をyとする
plt.show()
```

```{note}
**演習1**

$$
\int_0^\pi \sin x dx = 2
$$

について，  
1. 空間分割数$N = 1000, 3000, 10000, 30000$としたときの**区分求積法**での数値積分の値と真の値との誤差を可視化せよ．
   - 横軸：空間分割数$N$
   - 縦軸：誤差
```


### 散布図の例

```python
import matplotlib.pyplot as plt

x = [1, 2, 3, 4, 5]
y = [1.2, 1.9, 3.1, 3.8, 5.2]

fig, ax = plt.subplots()
ax.scatter(x, y) # 散布図の描画
ax.set_xlabel("x")
ax.set_ylabel("y")
ax.set_title("Scatter plot") # タイトルの設定
plt.show()
```

### ヒストグラムの例

```python
import matplotlib.pyplot as plt
import random

data = [random.random() for _ in range(1000)]

fig, ax = plt.subplots()
ax.hist(data, bins=20) # 幅20としてdata内のデータの数を数え上げる．
ax.set_xlabel("value") # 値
ax.set_ylabel("frequency") # 頻度
ax.set_title("Histogram")
plt.show()
```

### 棒グラフの例

```python
import matplotlib.pyplot as plt

labels = ["1", "2", "3", "4", "5", "6"]
counts = [820, 840, 830, 810, 850, 850]

fig, ax = plt.subplots()
ax.bar(labels, counts) # 棒グラフの描画
ax.set_xlabel("face")
ax.set_ylabel("count")
ax.set_title("Bar chart")

plt.show()
```

---

## 課題

```{note}
<span style="color:red">**課題1**</span>

第10回課題1で行った「サイコロを5000回振る実験」の結果を，サイコロの目ごとに出た回数を可視化せよ．

- 横軸：出目（1〜6）
- 縦軸：出た回数

どのグラフ（棒グラフ・折れ線など）を採用したか，
その理由をコメントとして書け．
```

```{note}
<span style="color:red">**課題2**</span>

$$
\int_0^1 x^3 dx = \frac{1}{4}
$$

について，  
空間分割数$N = 1000, 3000, 10000, 30000$としたときの**区分求積法**での数値積分の値と真の値との誤差を可視化せよ．
   - 横軸：空間分割数$N$
   - 縦軸：誤差

どのグラフ（棒グラフ・折れ線など）を採用したか， その理由をコメントとして書け．
```

---

## 授業アンケート

WebClassの「（2025 秋学期 I） 002284 フレッシュマンセミナーⅡ　　月　２時限　香川　渓一郎」から授業アンケートに回答してください．

---

## まとめ

- グラフは「**何を伝えたいか**」が重要
- Matplotlib は手段であり，目的は **理解と説明**


```{note}
演習1，課題1・2を実施したipynbファイルをWebClassの「第11回課題」より提出してください．

提出期限は **2026年1月5日(月)10:59** です．
```

---

<!-- 
```{note}
<span style="color:red">**課題（発展）**</span>

次の関数

$$
f(x) = \sin x
$$

について，点 $x=\frac{\pi}{3}$ における微分係数 $f'(x) = \cos x$ の数値微分を調べる．

1. **中心差分近似**

   $$
   f'(x) \approx \frac{f(x+h) - f(x-h)}{2h}
   $$

   を用いて，$h = 10^{-k}$（$k=1,2,\dots,10$）それぞれについて近似値と誤差を求め，
   「$h$ を小さくすると誤差がどのように変化するか」を **表またはリスト** にまとめよ．

2. 誤差が最も小さくなる $h$（最適な $h$）を見つけよ．
   また，$h$ を極端に小さくすると誤差が大きくなる理由を，自分の言葉で説明せよ．
   （ヒント：コンピュータの**浮動小数点誤差** が関係している．）

3. **中心差分と前進差分の比較**

   前進差分

   $$
   f'(x) \approx \frac{f(x+h) - f(x)}{h}
   $$

   についても同様に誤差を計算し，

   - どちらの方法が精度が高いか
   - 誤差の減り方がどう違うか

   を比較してコメントせよ．

4. （余力）誤差の変化を **log–log グラフ**（横軸：$h$，縦軸：誤差）でプロットし，
   差分近似の理論的な収束次数（前進差分：1次，中心差分：2次）が確認できるか調べよ．
``` 
-->
